; RUN: %polang_compiler --emit-mlir %s | %FileCheck %s

; Polymorphic functions with untyped parameters
; Types are resolved via monomorphization at call sites

; Polymorphic template function
; CHECK: {{.*}}polang.func @add3(%{{.*}}: !polang.typevar{{.*}}, %{{.*}}: !polang.typevar{{.*}}, %{{.*}}: !polang.typevar{{.*}}){{.*}}polang.polymorphic{{.*}}
; Monomorphized version
; CHECK: {{.*}}polang.func @add3$int_int_int(%{{.*}}: !polang.int, %{{.*}}: !polang.int, %{{.*}}: !polang.int) -> !polang.int{{.*}}
let add3(a, b, c) = (a + 0) + (b + 0) + (c + 0)

; Polymorphic template function
; CHECK: {{.*}}polang.func @scale3(%{{.*}}: !polang.typevar{{.*}}, %{{.*}}: !polang.typevar{{.*}}, %{{.*}}: !polang.typevar{{.*}}){{.*}}polang.polymorphic{{.*}}
; Monomorphized version
; CHECK: {{.*}}polang.func @scale3$double_double_double(%{{.*}}: !polang.double, %{{.*}}: !polang.double, %{{.*}}: !polang.double) -> !polang.double{{.*}}
let scale3(a, b, c) = (a * 1.0) + (b * 1.0) + (c * 1.0)

; Partially typed function (x is int, y is typevar)
; CHECK: {{.*}}polang.func @add_typed(%{{.*}}: !polang.int, %{{.*}}: !polang.typevar{{.*}}){{.*}}polang.polymorphic{{.*}}
; Monomorphized version
; CHECK: {{.*}}polang.func @add_typed$int_int(%{{.*}}: !polang.int, %{{.*}}: !polang.int) -> !polang.int{{.*}}
let add_typed(x: int, y) = x + y

; Call functions to create monomorphized versions
add3(1, 2, 3)
scale3(1.0, 2.0, 3.0)
add_typed(1, 2)
